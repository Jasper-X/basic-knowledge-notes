# 简述 MySQL MVCC 的实现原理

可重复读场景下，事务启动时，MySQL会为事务构造一个数组，用来保存此时的活跃事务ID，活跃指的是启动还没提交。

最小ID值记为低水位，最大ID值+1记为高水位。

如果trx_id小于低水位，表示事务启动前已经提交，可见。

如果trx_id大于高水位，表示事务启动前还未生成，不可见。

如果trx_id在高低水位中间，分两种情况：如果trx_id在数组中，表示事务启动时还未提交，不可见；如果不在，表示事务启动时已经提交，可见。

数据不可见时，会根据undo log找到可见数据。

InnoDB 就是利用 undo log 和 trx_id 的配合，实现了事务启动瞬间"秒级创建快照"的能力。