# 进程间有哪些通信方式？

## 一、匿名管道

实质上是一个内核缓冲区，一端进程将数据写入，另一端进程顺序读。

可以看做是一个循环队列，读和写的位置自动增长，数据只能被读一次，当读空或写满时，有一定的规则控制相应的读进程和写进程进入等待队列，当空缓冲区有新数据写入或满缓冲区有数据读出时，会唤醒等待队列中的进程继续读写。

#### 特点：

- 亲缘进程之间(父子、兄弟进程)
- 单向，半双工
- 大小有限
- 先进先出

## 二、有名管道

有名管道大多数特性与匿名管道相同。但是有几个不同点。

#### 与匿名管道的不同之处：

- 名字存在于文件系统中，内容存放在内存中
- 不仅仅用于亲缘进程
- 可以双向通信

## 三、信号

信号是Linux中异步通知进程的一种方式，是软件层对中断机制的模拟。如果进程不在执行状态，则会被内核保存，直到进程恢复执行。

信号来源：

- 硬件：键盘输入、硬件异常如无效的存储访问等
- 软件：终止进程、定时器超时等。

信号生命周期和处理流程：

- 信号被某个进程产生，并设置接收进程，交给操作系统
- 操作系统根据接收进程的状态(是否阻塞)选择性的发送，如果阻塞则暂时不发送，解除阻塞后发送给接收进程
- 接收进程收到信号后暂停当前工作，保护执行现场，执行信号处理程序，执行完成后再恢复之前的工作继续执行。

## 四、消息队列

消息队列是存放在内核中的消息链表，每个消息队列由消息队列标识符表示。

消息队列的特点：

- 允许多个进程写入或读取消息
- 消息有边界，不是字节流，降低了读写进程的复杂度
- 读消息可根据类型读取，而不只是严格的顺序读
- 存放在内核中，当内核重启或显式删除才会消失

## 五、共享内存

共享内存是目前是应用最广泛的进程通信方式。原理是多个进程共享一块物理内存区域，即让多个进程的线性地址范围映射到相同的物理内存页。

通过共享内存读写数据时无需经过内核转发，在用户态即可完成，所以也是最快的进程通信方式。

主要实现方式有：mmap系统调用，POSIX 共享内存，System V 共享内存

## 六、信号量

信号量可以理解为一个计数器，用于协调进程间的运行步调，也叫进程同步。通常与共享内存配合使用。

工作逻辑比较简单，有增加、减少、检查三种操作。

减少操作时，如果减少后小于 0，执行进程将被挂起，直到再次大于0。

检查操作用来检查当前信号量是否为0，若不是 0，该进程将被挂起，直到为0。

进程可同时操作多个信号量。并且对组内所有信号量的操作都是原子性的，要么同时完成组内所有信号量的指定操作，要么挂起进程。

## 七、套接字

套接字即为socket，是支持TCP/IP网络通信的基本操作单元，可以看做是不同主机之间的进程进行双向通信的端点。凭借socket可以实现跨主机进程间通信。

socket特性由3个属性确定：域、端口号、协议类型。

域包含AF_INET，指的是Internet网络，我们广泛应用的跨主机通信是基于这个域的；还包含AF_UNIX，表示UNIX文件系统，常见于sock后缀文件。

端口号是1-65535范围内的整数，可以根据端口号区别主机上的不同的程序。

协议类型包含流套接字、数据报套接字、原始套接字。

流套接字通过TCP实现，数据包套接字通过UDP实现，原始套接字通常是其他低层次协议比如IP、ICMP。



